<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
	<title>Bugle test</title>
</head>
<body>
	<script src="./../bugle.js"></script>
	<script type="text/javascript">
		// will add more comprehensive examples and tests to the project at a later date

		'use strict';

		const async = function(fn) {
			setTimeout(fn, 0);
		},

		// loop continuously until a condition is met
		when = function(condition, then) {

			async(function loop() {

				if(condition()) {
					then();
				} else {
					async(loop);
				}
			});
		},

		// test instances
		test = {
			
			'literal': {
				'state': [1,2,3,4],
				'update': function(topic, data) {
					this.state = this.state.concat(data);
				}
			},

			'instance': function Instance() {

				if(this instanceof Instance) {
					
					this.state = [5,4,3,2,1];
				
					this.execute = function(topic, data) {
						this.state.push(data);
					}

				} else {

					return new Instance();
				}
			}
		},

		// create our test instances

		literalObj = test.literal,
		instanceObj = test.instance(),

		// create new Bugle object
		bugle1 = Bugle();

		// test suite(s)
		when(
			function() { 
				return literalObj.state.length === 8 && 
					instanceObj.state.length === 6; 
			},
			function() {
				console.log('state change - literal object');
				console.log(literalObj.state);

				console.log('state change - instance object');
				console.log(instanceObj.state);
			}
		);

		when(
			function() {
				return bugle1.topics['joins'].indexOf(oid1) == -1 && 
					bugle1.topics['joins'].indexOf(oid2) == -1;
			},
			function() {
				console.log('oid(s): ' + oid1 + ' & ' + oid2 + ' unsubscribed from joins topic');
			}
		);


		// sub myObj to 'joins' topic
		// use the update property function when data is published to the topic
		var oid1 = bugle1.sub('joins', literalObj, 'update'),
		oid2 = bugle1.sub('joins', instanceObj, 'execute');

		// see the state of our pub/sub object
		console.log('subscribing to topic...');


		// pub array to joins topic
		console.log('publishing to topic...')
		bugle1.pub('joins', [5,6,7,8]);

		console.log('unsubscribing from topic...');
		bugle1.unsub('joins', oid1);
		bugle1.unsub('joins', oid2);

	</script>
</body>
</html>